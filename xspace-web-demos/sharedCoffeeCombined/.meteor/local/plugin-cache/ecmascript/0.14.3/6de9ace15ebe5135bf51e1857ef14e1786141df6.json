{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffeeCombined/packages/ostrio:flow-router-extra/client/triggers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ostrio:flow-router-extra/client/triggers.js","filename":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffeeCombined/packages/ostrio:flow-router-extra/client/triggers.js","passPerPreset":false,"envName":"development","cwd":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffeeCombined","root":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffeeCombined","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffeeCombined/packages/ostrio:flow-router-extra/client/triggers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:flow-router-extra/client/triggers.js"}},"code":"// a set of utility functions for triggers\nconst Triggers = {}; // Apply filters for a set of triggers\n// @triggers - a set of triggers\n// @filter - filter with array fields with `only` and `except`\n//           support only either `only` or `except`, but not both\n\nTriggers.applyFilters = (_triggers, filter) => {\n  let triggers = _triggers;\n\n  if (!(triggers instanceof Array)) {\n    triggers = [triggers];\n  }\n\n  if (!filter) {\n    return triggers;\n  }\n\n  if (filter.only && filter.except) {\n    throw new Error('Triggers don\\'t support only and except filters at once');\n  }\n\n  if (filter.only && !(filter.only instanceof Array)) {\n    throw new Error('only filters needs to be an array');\n  }\n\n  if (filter.except && !(filter.except instanceof Array)) {\n    throw new Error('except filters needs to be an array');\n  }\n\n  if (filter.only) {\n    return Triggers.createRouteBoundTriggers(triggers, filter.only);\n  }\n\n  if (filter.except) {\n    return Triggers.createRouteBoundTriggers(triggers, filter.except, true);\n  }\n\n  throw new Error('Provided a filter but not supported');\n}; //  create triggers by bounding them to a set of route names\n//  @triggers - a set of triggers\n//  @names - list of route names to be bound (trigger runs only for these names)\n//  @negate - negate the result (triggers won't run for above names)\n\n\nTriggers.createRouteBoundTriggers = (triggers, names, negate) => {\n  const namesMap = {};\n  names.forEach(name => {\n    namesMap[name] = true;\n  });\n  const filteredTriggers = triggers.map(originalTrigger => {\n    const modifiedTrigger = (context, next) => {\n      let matched = namesMap[context.route.name] ? 1 : -1;\n      matched = negate ? matched * -1 : matched;\n\n      if (matched === 1) {\n        originalTrigger(context, next);\n      }\n    };\n\n    return modifiedTrigger;\n  });\n  return filteredTriggers;\n}; //  run triggers and abort if redirected or callback stopped\n//  @triggers - a set of triggers\n//  @context - context we need to pass (it must have the route)\n//  @redirectFn - function which used to redirect\n//  @after - called after if only all the triggers runs\n\n\nTriggers.runTriggers = (triggers, context, redirectFn, after, data) => {\n  let abort = false;\n  let inCurrentLoop = true;\n  let alreadyRedirected = false;\n\n  const doRedirect = (url, params, queryParams) => {\n    if (alreadyRedirected) {\n      throw new Error('already redirected');\n    }\n\n    if (!inCurrentLoop) {\n      throw new Error('redirect needs to be done in sync');\n    }\n\n    if (!url) {\n      throw new Error('trigger redirect requires an URL');\n    }\n\n    abort = true;\n    alreadyRedirected = true;\n    redirectFn(url, params, queryParams);\n  };\n\n  const doStop = () => {\n    abort = true;\n  };\n\n  for (let lc = 0; lc < triggers.length; lc++) {\n    triggers[lc](context, doRedirect, doStop, data);\n\n    if (abort) {\n      return;\n    }\n  } // mark that, we've exceeds the currentEventloop for\n  // this set of triggers.\n\n\n  inCurrentLoop = false;\n  after();\n};\n\nmodule.exportDefault(Triggers);","map":{"version":3,"sources":["packages/ostrio:flow-router-extra/client/triggers.js"],"names":["Triggers","applyFilters","_triggers","filter","triggers","Array","only","except","Error","createRouteBoundTriggers","names","negate","namesMap","forEach","name","filteredTriggers","map","originalTrigger","modifiedTrigger","context","next","matched","route","runTriggers","redirectFn","after","data","abort","inCurrentLoop","alreadyRedirected","doRedirect","url","params","queryParams","doStop","lc","length","module","exportDefault"],"mappings":"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","sourcesContent":["// a set of utility functions for triggers\n\nconst Triggers = {};\n\n// Apply filters for a set of triggers\n// @triggers - a set of triggers\n// @filter - filter with array fields with `only` and `except`\n//           support only either `only` or `except`, but not both\nTriggers.applyFilters = (_triggers, filter) => {\n  let triggers = _triggers;\n  if(!(triggers instanceof Array)) {\n    triggers = [triggers];\n  }\n\n  if(!filter) {\n    return triggers;\n  }\n\n  if(filter.only && filter.except) {\n    throw new Error('Triggers don\\'t support only and except filters at once');\n  }\n\n  if(filter.only && !(filter.only instanceof Array)) {\n    throw new Error('only filters needs to be an array');\n  }\n\n  if(filter.except && !(filter.except instanceof Array)) {\n    throw new Error('except filters needs to be an array');\n  }\n\n  if(filter.only) {\n    return Triggers.createRouteBoundTriggers(triggers, filter.only);\n  }\n\n  if(filter.except) {\n    return Triggers.createRouteBoundTriggers(triggers, filter.except, true);\n  }\n\n  throw new Error('Provided a filter but not supported');\n};\n\n//  create triggers by bounding them to a set of route names\n//  @triggers - a set of triggers\n//  @names - list of route names to be bound (trigger runs only for these names)\n//  @negate - negate the result (triggers won't run for above names)\nTriggers.createRouteBoundTriggers = (triggers, names, negate) => {\n  const namesMap = {};\n  names.forEach((name) => {\n    namesMap[name] = true;\n  });\n\n  const filteredTriggers = triggers.map((originalTrigger) => {\n    const modifiedTrigger = (context, next) => {\n      let matched = (namesMap[context.route.name]) ? 1 : -1;\n      matched = (negate) ? matched * -1 : matched;\n\n      if(matched === 1) {\n        originalTrigger(context, next);\n      }\n    };\n    return modifiedTrigger;\n  });\n\n  return filteredTriggers;\n};\n\n//  run triggers and abort if redirected or callback stopped\n//  @triggers - a set of triggers\n//  @context - context we need to pass (it must have the route)\n//  @redirectFn - function which used to redirect\n//  @after - called after if only all the triggers runs\nTriggers.runTriggers = (triggers, context, redirectFn, after, data) => {\n  let abort = false;\n  let inCurrentLoop = true;\n  let alreadyRedirected = false;\n\n  const doRedirect = (url, params, queryParams) => {\n    if(alreadyRedirected) {\n      throw new Error('already redirected');\n    }\n\n    if(!inCurrentLoop) {\n      throw new Error('redirect needs to be done in sync');\n    }\n\n    if(!url) {\n      throw new Error('trigger redirect requires an URL');\n    }\n\n    abort = true;\n    alreadyRedirected = true;\n    redirectFn(url, params, queryParams);\n  };\n\n  const doStop = () => {\n    abort = true;\n  };\n\n  for (let lc = 0; lc < triggers.length; lc++) {\n    triggers[lc](context, doRedirect, doStop, data);\n\n    if (abort) {\n      return;\n    }\n  }\n\n  // mark that, we've exceeds the currentEventloop for\n  // this set of triggers.\n  inCurrentLoop = false;\n  after();\n};\n\nexport default Triggers;\n"]},"sourceType":"module","hash":"6de9ace15ebe5135bf51e1857ef14e1786141df6"}
