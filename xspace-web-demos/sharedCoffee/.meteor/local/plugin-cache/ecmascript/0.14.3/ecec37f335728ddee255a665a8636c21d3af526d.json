{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee/packages/ostrio:flow-router-extra/client/renderer.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ostrio:flow-router-extra/client/renderer.js","filename":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee/packages/ostrio:flow-router-extra/client/renderer.js","passPerPreset":false,"envName":"development","cwd":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee","root":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee/packages/ostrio:flow-router-extra/client/renderer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:flow-router-extra/client/renderer.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\n\nlet _helpers;\n\nmodule.link(\"./../lib/_helpers.js\", {\n  _helpers(v) {\n    _helpers = v;\n  }\n\n}, 1);\nlet requestAnimFrame;\nmodule.link(\"./modules.js\", {\n  requestAnimFrame(v) {\n    requestAnimFrame = v;\n  }\n\n}, 2);\nlet Blaze;\nlet Template;\n\nif (Package.templating && Package.blaze) {\n  Blaze = Package.blaze.Blaze;\n  Template = Package.templating.Template;\n}\n\nconst _BlazeRemove = function (view) {\n  try {\n    Blaze.remove(view);\n  } catch (_e) {\n    try {\n      Blaze._destroyView(view);\n\n      view._domrange.destroy();\n    } catch (__e) {\n      view._domrange.destroy();\n    }\n  }\n};\n\nclass BlazeRenderer {\n  constructor() {\n    let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    this.rootElement = opts.rootElement || function () {\n      return document.body;\n    };\n\n    const self = this;\n    this.isRendering = false;\n    this.queue = [];\n    this.yield = null;\n    this.cache = {};\n    this.old = this.newState();\n    this.old.materialized = true;\n    this.router = opts.router || false;\n    this.inMemoryRendering = opts.inMemoryRendering || false;\n\n    this.getMemoryElement = opts.getMemoryElement || function () {\n      return document.createElement('div');\n    };\n\n    if (!this.getMemoryElement || !_helpers.isFunction(this.getMemoryElement)) {\n      throw new Meteor.Error(400, '{getMemoryElement} must be a function, which returns new DOM element');\n    }\n\n    if (!this.rootElement || !_helpers.isFunction(this.rootElement)) {\n      throw new Meteor.Error(400, 'You must pass function into BlazeRenderer constructor, which returns DOM element');\n    }\n\n    Template.yield = new Template('yield', function () {});\n    Template.yield.onCreated(function () {\n      self.yield = this;\n    });\n    Template.yield.onRendered(function () {\n      self.yield = this;\n      self.materialize(self.old);\n    });\n    Template.yield.onDestroyed(function () {\n      if (self.old.template.view) {\n        _BlazeRemove(self.old.template.view);\n\n        self.old.template.view = null;\n        self.old.materialized = false;\n      }\n\n      self.yield = null;\n    });\n  }\n\n  render(__layout) {\n    let __template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    let __data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    let __callback = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (!Blaze || !Template) {\n      throw new Meteor.Error(400, '`.render()` - Requires `blaze` and `templating`, or `blaze-html-templates` packages to be installed');\n    }\n\n    if (!__layout) {\n      throw new Meteor.Error(400, '`.render()` - Requires at least one argument');\n    } else if (!_helpers.isString(__layout) && !(__layout instanceof Blaze.Template)) {\n      throw new Meteor.Error(400, '`.render()` - First argument must be a String or instance of Blaze.Template');\n    }\n\n    this.queue.push([__layout, __template, __data, __callback]);\n    this.startQueue();\n  }\n\n  startQueue() {\n    if (this.queue.length) {\n      if (!this.isRendering) {\n        this.isRendering = true;\n        const task = this.queue.shift();\n        this.proceed.apply(this, task);\n\n        if (this.queue.length) {\n          requestAnimFrame(this.startQueue.bind(this));\n        }\n      } else {\n        requestAnimFrame(this.startQueue.bind(this));\n      }\n    }\n  }\n\n  proceed(__layout) {\n    let __template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    let __data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    let __callback = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    let data = __data;\n    let layout = __layout;\n    let _layout = false;\n    let template = __template;\n    let _template = false;\n\n    let callback = __callback || (() => {});\n\n    if (_helpers.isString(layout)) {\n      _layout = typeof Template !== 'undefined' && Template !== null ? Template[layout] : void 0;\n    } else if (layout instanceof Blaze.Template) {\n      _layout = layout;\n      layout = layout.viewName.replace('Template.', '');\n    } else {\n      layout = false;\n    }\n\n    if (_helpers.isString(template)) {\n      _template = typeof Template !== 'undefined' && Template !== null ? Template[template] : void 0;\n    } else if (template instanceof Blaze.Template) {\n      _template = template;\n      template = template.viewName.replace('Template.', '');\n    } else if (_helpers.isObject(template)) {\n      data = template;\n      template = false;\n    } else if (_helpers.isFunction(template)) {\n      callback = template;\n      template = false;\n    } else {\n      template = false;\n    }\n\n    if (_helpers.isFunction(data)) {\n      callback = data;\n      data = {};\n    } else if (!_helpers.isObject(data)) {\n      data = {};\n    }\n\n    if (!_helpers.isFunction(callback)) {\n      callback = () => {};\n    }\n\n    if (!_layout) {\n      this.old.materialized = true;\n      this.isRendering = false;\n      const error = new Meteor.Error(404, \"No such layout template: \".concat(layout));\n      this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, error);\n      callback(error);\n      throw error;\n    }\n\n    const current = this.newState(layout, template);\n    current.data = data;\n    current.callback = callback;\n    let updateTemplate = true;\n    const forceReRender = this.router && this.router._current && this.router._current.route && this.router._current.route.conf && this.router._current.route.conf.forceReRender === true;\n\n    if (template) {\n      if (!_template) {\n        this.old.materialized = true;\n        this.isRendering = false;\n        const error = new Meteor.Error(404, \"No such template: \".concat(template));\n        this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, error);\n        current.callback(error);\n        throw error;\n      }\n\n      if (forceReRender || this.old.template.name !== template) {\n        current.template.name = template;\n        current.template.blaze = _template;\n        this.newElement('template', current);\n\n        if (this.old.template.view) {\n          _BlazeRemove(this.old.template.view);\n\n          this.old.template.view = null;\n          this.old.materialized = false;\n        }\n\n        updateTemplate = false;\n      } else {\n        current.template = this.old.template;\n      }\n    }\n\n    if (!template || this.old.layout.name !== layout) {\n      current.layout.name = layout;\n      current.layout.blaze = _layout;\n      current.template.name = template;\n      current.template.blaze = _template;\n      this.newElement('layout', current);\n\n      if (this.old.layout.view) {\n        _BlazeRemove(this.old.layout.view);\n\n        this.old.layout.view = null;\n      }\n\n      this._render(current);\n    } else if (template) {\n      current.layout = this.old.layout;\n      current.template.name = template;\n      current.template.blaze = _template;\n\n      this._load(updateTemplate, true, current);\n    } else {\n      current.layout = this.old.layout;\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n\n      current.callback = () => {};\n    }\n\n    this.old = current;\n  }\n\n  _render(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    const getData = () => {\n      return current.data;\n    };\n\n    const rootElement = this.rootElement();\n\n    if (!rootElement) {\n      throw new Meteor.Error(400, 'BlazeRenderer can\\'t find root element!');\n    }\n\n    if (this.inMemoryRendering) {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, current.layout.element);\n      requestAnimFrame(() => {\n        rootElement.appendChild(current.layout.element);\n\n        this._load(false, false, current);\n      });\n    } else {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, rootElement);\n\n      this._load(false, false, current);\n    }\n  }\n\n  _load(updateTemplate, updateLayout, current) {\n    if (updateLayout && current.layout.view) {\n      current.layout.view.dataVar.set(current.data);\n    }\n\n    if (current.template.view && updateTemplate) {\n      current.template.view.dataVar.set(current.data);\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n\n      current.callback = () => {};\n    } else if (!current.template.name) {\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n\n      current.callback = () => {};\n    } else if (current.template.name && !this.yield) {\n      this.isRendering = false;\n      current.materialized = false;\n      current.callback();\n\n      current.callback = () => {};\n    } else if (current.template.name && this.yield) {\n      this.materialize(current);\n    }\n  }\n\n  newElement(type, current) {\n    if (!this.inMemoryRendering) {\n      return;\n    }\n\n    current[type].parent = current[type].parent ? current[type].parent : document.createElement('div');\n\n    if (!current[type].element) {\n      current[type].element = this.getMemoryElement();\n      current[type].parent.appendChild(current[type].element);\n      current[type].element._parentElement = current[type].parent;\n    }\n  }\n\n  newState() {\n    let layout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    let template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    const base = {\n      materialized: false,\n      data: null,\n      callback: function () {},\n      layout: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      },\n      template: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      }\n    };\n\n    if (!this.inMemoryRendering || !layout && !template) {\n      return base;\n    }\n\n    if (layout && this.cache[layout]) {\n      base.layout = this.cache[layout];\n    }\n\n    if (template && this.cache[template]) {\n      base.template = this.cache[template];\n    }\n\n    this.cache[template] = base;\n    return base;\n  }\n\n  materialize(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    if (current.template.name && !current.materialized) {\n      const getData = () => {\n        return current.data;\n      };\n\n      if (!this.yield) {\n        current.materialized = false;\n        return;\n      }\n\n      current.materialized = true;\n\n      if (this.inMemoryRendering) {\n        current.template.view = Blaze.renderWithData(current.template.blaze, getData, current.template.element, this.yield.view);\n\n        if (this.yield) {\n          this.yield.view._domrange.parentElement.appendChild(current.template.element);\n\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      } else {\n        if (this.yield) {\n          current.template.view = Blaze.renderWithData(current.template.blaze, getData, this.yield.view._domrange.parentElement, this.yield.view);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      }\n    }\n  }\n\n}\n\nmodule.exportDefault(BlazeRenderer);","map":{"version":3,"sources":["packages/ostrio:flow-router-extra/client/renderer.js"],"names":["Meteor","module","link","v","_helpers","requestAnimFrame","Blaze","Template","Package","templating","blaze","_BlazeRemove","view","remove","_e","_destroyView","_domrange","destroy","__e","BlazeRenderer","constructor","opts","rootElement","document","body","self","isRendering","queue","yield","cache","old","newState","materialized","router","inMemoryRendering","getMemoryElement","createElement","isFunction","Error","onCreated","onRendered","materialize","onDestroyed","template","render","__layout","__template","__data","__callback","isString","push","startQueue","length","task","shift","proceed","apply","bind","data","layout","_layout","_template","callback","viewName","replace","isObject","error","onRenderError","call","current","updateTemplate","forceReRender","_current","route","conf","name","newElement","_render","_load","getData","renderWithData","element","appendChild","updateLayout","dataVar","set","type","parent","_parentElement","base","parentElement","exportDefault"],"mappings":"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","sourcesContent":["import { Meteor }           from 'meteor/meteor';\nimport { _helpers }         from './../lib/_helpers.js';\nimport { requestAnimFrame } from './modules.js';\n\nlet Blaze;\nlet Template;\n\nif (Package.templating && Package.blaze) {\n  Blaze    = Package.blaze.Blaze;\n  Template = Package.templating.Template;\n}\n\nconst _BlazeRemove = function (view) {\n  try {\n    Blaze.remove(view);\n  } catch (_e) {\n    try {\n      Blaze._destroyView(view);\n      view._domrange.destroy();\n    } catch (__e) {\n      view._domrange.destroy();\n    }\n  }\n};\n\nclass BlazeRenderer {\n  constructor(opts = {}) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    this.rootElement  = opts.rootElement || function () {\n      return document.body;\n    };\n\n    const self        = this;\n    this.isRendering  = false;\n    this.queue        = [];\n    this.yield        = null;\n    this.cache        = {};\n    this.old          = this.newState();\n    this.old.materialized = true;\n\n    this.router            = opts.router || false;\n    this.inMemoryRendering = opts.inMemoryRendering || false;\n    this.getMemoryElement  = opts.getMemoryElement || function () {\n      return document.createElement('div');\n    };\n\n    if (!this.getMemoryElement || !_helpers.isFunction(this.getMemoryElement)) {\n      throw new Meteor.Error(400, '{getMemoryElement} must be a function, which returns new DOM element');\n    }\n\n    if (!this.rootElement || !_helpers.isFunction(this.rootElement)) {\n      throw new Meteor.Error(400, 'You must pass function into BlazeRenderer constructor, which returns DOM element');\n    }\n\n    Template.yield = new Template('yield', function () {});\n\n    Template.yield.onCreated(function () {\n      self.yield = this;\n    });\n\n    Template.yield.onRendered(function () {\n      self.yield = this;\n      self.materialize(self.old);\n    });\n\n    Template.yield.onDestroyed(function () {\n      if (self.old.template.view) {\n        _BlazeRemove(self.old.template.view);\n        self.old.template.view = null;\n        self.old.materialized = false;\n      }\n      self.yield = null;\n    });\n  }\n\n  render(__layout, __template = false, __data = {}, __callback) {\n    if (!Blaze || !Template) {\n      throw new Meteor.Error(400, '`.render()` - Requires `blaze` and `templating`, or `blaze-html-templates` packages to be installed');\n    }\n\n    if (!__layout) {\n      throw new Meteor.Error(400, '`.render()` - Requires at least one argument');\n    } else if (!_helpers.isString(__layout) && !(__layout instanceof Blaze.Template)) {\n      throw new Meteor.Error(400, '`.render()` - First argument must be a String or instance of Blaze.Template');\n    }\n\n    this.queue.push([__layout, __template, __data, __callback]);\n    this.startQueue();\n  }\n\n  startQueue() {\n    if (this.queue.length) {\n      if (!this.isRendering) {\n        this.isRendering = true;\n        const task = this.queue.shift();\n        this.proceed.apply(this, task);\n        if (this.queue.length) {\n          requestAnimFrame(this.startQueue.bind(this));\n        }\n      } else {\n        requestAnimFrame(this.startQueue.bind(this));\n      }\n    }\n  }\n\n  proceed(__layout, __template = false, __data = {}, __callback) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    let data      = __data;\n    let layout    = __layout;\n    let _layout   = false;\n    let template  = __template;\n    let _template = false;\n    let callback  = __callback || (() => {});\n\n    if (_helpers.isString(layout)) {\n      _layout = typeof Template !== 'undefined' && Template !== null ? Template[layout] : void 0;\n    } else if (layout instanceof Blaze.Template) {\n      _layout = layout;\n      layout  = layout.viewName.replace('Template.', '');\n    } else {\n      layout = false;\n    }\n\n    if (_helpers.isString(template)) {\n      _template = typeof Template !== 'undefined' && Template !== null ? Template[template] : void 0;\n    } else if (template instanceof Blaze.Template) {\n      _template = template;\n      template  = template.viewName.replace('Template.', '');\n    } else if (_helpers.isObject(template)) {\n      data     = template;\n      template = false;\n    } else if (_helpers.isFunction(template)) {\n      callback = template;\n      template = false;\n    } else {\n      template = false;\n    }\n\n    if (_helpers.isFunction(data)) {\n      callback = data;\n      data = {};\n    } else if (!_helpers.isObject(data)) {\n      data = {};\n    }\n\n    if (!_helpers.isFunction(callback)) {\n      callback = () => {};\n    }\n\n    if (!_layout) {\n      this.old.materialized = true;\n      this.isRendering = false;\n      const error = new Meteor.Error(404, `No such layout template: ${layout}`);\n      this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, error);\n      callback(error);\n      throw error;\n    }\n\n    const current      = this.newState(layout, template);\n    current.data       = data;\n    current.callback   = callback;\n    let updateTemplate = true;\n\n    const forceReRender = this.router && this.router._current && this.router._current.route && this.router._current.route.conf && this.router._current.route.conf.forceReRender === true;\n    if (template) {\n      if (!_template) {\n        this.old.materialized = true;\n        this.isRendering = false;\n        const error = new Meteor.Error(404, `No such template: ${template}`);\n        this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, error);\n        current.callback(error);\n        throw error;\n      }\n\n      if (forceReRender || this.old.template.name !== template) {\n        current.template.name  = template;\n        current.template.blaze = _template;\n        this.newElement('template', current);\n\n        if (this.old.template.view) {\n          _BlazeRemove(this.old.template.view);\n          this.old.template.view = null;\n          this.old.materialized = false;\n        }\n        updateTemplate = false;\n      } else {\n        current.template = this.old.template;\n      }\n    }\n\n    if (!template || this.old.layout.name !== layout) {\n      current.layout.name    = layout;\n      current.layout.blaze   = _layout;\n      current.template.name  = template;\n      current.template.blaze = _template;\n      this.newElement('layout', current);\n\n      if (this.old.layout.view) {\n        _BlazeRemove(this.old.layout.view);\n        this.old.layout.view = null;\n      }\n\n      this._render(current);\n    } else if (template) {\n      current.layout         = this.old.layout;\n      current.template.name  = template;\n      current.template.blaze = _template;\n      this._load(updateTemplate, true, current);\n    } else {\n      current.layout = this.old.layout;\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    }\n\n    this.old = current;\n  }\n\n  _render(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    const getData = () => {\n      return current.data;\n    };\n\n    const rootElement = this.rootElement();\n    if (!rootElement) {\n      throw new Meteor.Error(400, 'BlazeRenderer can\\'t find root element!');\n    }\n\n    if (this.inMemoryRendering) {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, current.layout.element);\n      requestAnimFrame(() => {\n        rootElement.appendChild(current.layout.element);\n        this._load(false, false, current);\n      });\n    } else {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, rootElement);\n      this._load(false, false, current);\n    }\n  }\n\n  _load(updateTemplate, updateLayout, current) {\n    if (updateLayout && current.layout.view) {\n      current.layout.view.dataVar.set(current.data);\n    }\n\n    if (current.template.view && updateTemplate) {\n      current.template.view.dataVar.set(current.data);\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    } else if (!current.template.name) {\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    } else if (current.template.name && !this.yield) {\n      this.isRendering = false;\n      current.materialized = false;\n      current.callback();\n      current.callback = () => {};\n    } else if (current.template.name && this.yield) {\n      this.materialize(current);\n    }\n  }\n\n  newElement(type, current) {\n    if (!this.inMemoryRendering) {\n      return;\n    }\n\n    current[type].parent = current[type].parent ? current[type].parent : document.createElement('div');\n    if (!current[type].element) {\n      current[type].element = this.getMemoryElement();\n      current[type].parent.appendChild(current[type].element);\n      current[type].element._parentElement = current[type].parent;\n    }\n  }\n\n  newState(layout = false, template = false) {\n    const base = {\n      materialized: false,\n      data: null,\n      callback: function () {},\n      layout: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      },\n      template: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      }\n    };\n\n    if (!this.inMemoryRendering || (!layout && !template)) {\n      return base;\n    }\n\n    if (layout && this.cache[layout]) {\n      base.layout = this.cache[layout];\n    }\n\n    if (template && this.cache[template]) {\n      base.template = this.cache[template];\n    }\n\n    this.cache[template] = base;\n    return base;\n  }\n\n  materialize(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    if (current.template.name && !current.materialized) {\n      const getData = () => {\n        return current.data;\n      };\n\n      if (!this.yield) {\n        current.materialized = false;\n        return;\n      }\n\n      current.materialized = true;\n      if (this.inMemoryRendering) {\n        current.template.view = Blaze.renderWithData(current.template.blaze, getData, current.template.element, this.yield.view);\n        if (this.yield) {\n          this.yield.view._domrange.parentElement.appendChild(current.template.element);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      } else {\n        if (this.yield) {\n          current.template.view = Blaze.renderWithData(current.template.blaze, getData, this.yield.view._domrange.parentElement, this.yield.view);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      }\n    }\n  }\n}\n\nexport default BlazeRenderer;\n"]},"sourceType":"module","hash":"ecec37f335728ddee255a665a8636c21d3af526d"}
