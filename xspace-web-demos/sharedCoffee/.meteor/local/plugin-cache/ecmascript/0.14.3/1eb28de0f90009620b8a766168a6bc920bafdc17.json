{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee/packages/ostrio:flow-router-extra/client/renderer.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/ostrio:flow-router-extra/client/renderer.js","filename":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee/packages/ostrio:flow-router-extra/client/renderer.js","passPerPreset":false,"envName":"development","cwd":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee","root":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jaylin/Documents/xspace/xspace-web-demos/sharedCoffee/packages/ostrio:flow-router-extra/client/renderer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:flow-router-extra/client/renderer.js"}},"code":"var Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\n\nvar _helpers;\n\nmodule.link(\"./../lib/_helpers.js\", {\n  _helpers: function (v) {\n    _helpers = v;\n  }\n}, 1);\nvar requestAnimFrame;\nmodule.link(\"./modules.js\", {\n  requestAnimFrame: function (v) {\n    requestAnimFrame = v;\n  }\n}, 2);\nvar Blaze;\nvar Template;\n\nif (Package.templating && Package.blaze) {\n  Blaze = Package.blaze.Blaze;\n  Template = Package.templating.Template;\n}\n\nvar _BlazeRemove = function (view) {\n  try {\n    Blaze.remove(view);\n  } catch (_e) {\n    try {\n      Blaze._destroyView(view);\n\n      view._domrange.destroy();\n    } catch (__e) {\n      view._domrange.destroy();\n    }\n  }\n};\n\nvar BlazeRenderer = /*#__PURE__*/function () {\n  function BlazeRenderer() {\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    this.rootElement = opts.rootElement || function () {\n      return document.body;\n    };\n\n    var self = this;\n    this.isRendering = false;\n    this.queue = [];\n    this.yield = null;\n    this.cache = {};\n    this.old = this.newState();\n    this.old.materialized = true;\n    this.router = opts.router || false;\n    this.inMemoryRendering = opts.inMemoryRendering || false;\n\n    this.getMemoryElement = opts.getMemoryElement || function () {\n      return document.createElement('div');\n    };\n\n    if (!this.getMemoryElement || !_helpers.isFunction(this.getMemoryElement)) {\n      throw new Meteor.Error(400, '{getMemoryElement} must be a function, which returns new DOM element');\n    }\n\n    if (!this.rootElement || !_helpers.isFunction(this.rootElement)) {\n      throw new Meteor.Error(400, 'You must pass function into BlazeRenderer constructor, which returns DOM element');\n    }\n\n    Template.yield = new Template('yield', function () {});\n    Template.yield.onCreated(function () {\n      self.yield = this;\n    });\n    Template.yield.onRendered(function () {\n      self.yield = this;\n      self.materialize(self.old);\n    });\n    Template.yield.onDestroyed(function () {\n      if (self.old.template.view) {\n        _BlazeRemove(self.old.template.view);\n\n        self.old.template.view = null;\n        self.old.materialized = false;\n      }\n\n      self.yield = null;\n    });\n  }\n\n  var _proto = BlazeRenderer.prototype;\n\n  _proto.render = function () {\n    function render(__layout) {\n      var __template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      var __data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      var __callback = arguments.length > 3 ? arguments[3] : undefined;\n\n      if (!Blaze || !Template) {\n        throw new Meteor.Error(400, '`.render()` - Requires `blaze` and `templating`, or `blaze-html-templates` packages to be installed');\n      }\n\n      if (!__layout) {\n        throw new Meteor.Error(400, '`.render()` - Requires at least one argument');\n      } else if (!_helpers.isString(__layout) && !(__layout instanceof Blaze.Template)) {\n        throw new Meteor.Error(400, '`.render()` - First argument must be a String or instance of Blaze.Template');\n      }\n\n      this.queue.push([__layout, __template, __data, __callback]);\n      this.startQueue();\n    }\n\n    return render;\n  }();\n\n  _proto.startQueue = function () {\n    function startQueue() {\n      if (this.queue.length) {\n        if (!this.isRendering) {\n          this.isRendering = true;\n          var task = this.queue.shift();\n          this.proceed.apply(this, task);\n\n          if (this.queue.length) {\n            requestAnimFrame(this.startQueue.bind(this));\n          }\n        } else {\n          requestAnimFrame(this.startQueue.bind(this));\n        }\n      }\n    }\n\n    return startQueue;\n  }();\n\n  _proto.proceed = function () {\n    function proceed(__layout) {\n      var __template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      var __data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      var __callback = arguments.length > 3 ? arguments[3] : undefined;\n\n      if (!Blaze || !Template) {\n        return;\n      }\n\n      var data = __data;\n      var layout = __layout;\n      var _layout = false;\n      var template = __template;\n      var _template = false;\n\n      var callback = __callback || function () {};\n\n      if (_helpers.isString(layout)) {\n        _layout = typeof Template !== 'undefined' && Template !== null ? Template[layout] : void 0;\n      } else if (layout instanceof Blaze.Template) {\n        _layout = layout;\n        layout = layout.viewName.replace('Template.', '');\n      } else {\n        layout = false;\n      }\n\n      if (_helpers.isString(template)) {\n        _template = typeof Template !== 'undefined' && Template !== null ? Template[template] : void 0;\n      } else if (template instanceof Blaze.Template) {\n        _template = template;\n        template = template.viewName.replace('Template.', '');\n      } else if (_helpers.isObject(template)) {\n        data = template;\n        template = false;\n      } else if (_helpers.isFunction(template)) {\n        callback = template;\n        template = false;\n      } else {\n        template = false;\n      }\n\n      if (_helpers.isFunction(data)) {\n        callback = data;\n        data = {};\n      } else if (!_helpers.isObject(data)) {\n        data = {};\n      }\n\n      if (!_helpers.isFunction(callback)) {\n        callback = function () {};\n      }\n\n      if (!_layout) {\n        this.old.materialized = true;\n        this.isRendering = false;\n        var error = new Meteor.Error(404, \"No such layout template: \" + layout);\n        this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, error);\n        callback(error);\n        throw error;\n      }\n\n      var current = this.newState(layout, template);\n      current.data = data;\n      current.callback = callback;\n      var updateTemplate = true;\n      var forceReRender = this.router && this.router._current && this.router._current.route && this.router._current.route.conf && this.router._current.route.conf.forceReRender === true;\n\n      if (template) {\n        if (!_template) {\n          this.old.materialized = true;\n          this.isRendering = false;\n\n          var _error = new Meteor.Error(404, \"No such template: \" + template);\n\n          this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, _error);\n          current.callback(_error);\n          throw _error;\n        }\n\n        if (forceReRender || this.old.template.name !== template) {\n          current.template.name = template;\n          current.template.blaze = _template;\n          this.newElement('template', current);\n\n          if (this.old.template.view) {\n            _BlazeRemove(this.old.template.view);\n\n            this.old.template.view = null;\n            this.old.materialized = false;\n          }\n\n          updateTemplate = false;\n        } else {\n          current.template = this.old.template;\n        }\n      }\n\n      if (!template || this.old.layout.name !== layout) {\n        current.layout.name = layout;\n        current.layout.blaze = _layout;\n        current.template.name = template;\n        current.template.blaze = _template;\n        this.newElement('layout', current);\n\n        if (this.old.layout.view) {\n          _BlazeRemove(this.old.layout.view);\n\n          this.old.layout.view = null;\n        }\n\n        this._render(current);\n      } else if (template) {\n        current.layout = this.old.layout;\n        current.template.name = template;\n        current.template.blaze = _template;\n\n        this._load(updateTemplate, true, current);\n      } else {\n        current.layout = this.old.layout;\n        this.isRendering = false;\n        current.materialized = true;\n        current.callback();\n\n        current.callback = function () {};\n      }\n\n      this.old = current;\n    }\n\n    return proceed;\n  }();\n\n  _proto._render = function () {\n    function _render(current) {\n      var _this = this;\n\n      if (!Blaze || !Template) {\n        return;\n      }\n\n      var getData = function () {\n        return current.data;\n      };\n\n      var rootElement = this.rootElement();\n\n      if (!rootElement) {\n        throw new Meteor.Error(400, 'BlazeRenderer can\\'t find root element!');\n      }\n\n      if (this.inMemoryRendering) {\n        current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, current.layout.element);\n        requestAnimFrame(function () {\n          rootElement.appendChild(current.layout.element);\n\n          _this._load(false, false, current);\n        });\n      } else {\n        current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, rootElement);\n\n        this._load(false, false, current);\n      }\n    }\n\n    return _render;\n  }();\n\n  _proto._load = function () {\n    function _load(updateTemplate, updateLayout, current) {\n      if (updateLayout && current.layout.view) {\n        current.layout.view.dataVar.set(current.data);\n      }\n\n      if (current.template.view && updateTemplate) {\n        current.template.view.dataVar.set(current.data);\n        this.isRendering = false;\n        current.materialized = true;\n        current.callback();\n\n        current.callback = function () {};\n      } else if (!current.template.name) {\n        this.isRendering = false;\n        current.materialized = true;\n        current.callback();\n\n        current.callback = function () {};\n      } else if (current.template.name && !this.yield) {\n        this.isRendering = false;\n        current.materialized = false;\n        current.callback();\n\n        current.callback = function () {};\n      } else if (current.template.name && this.yield) {\n        this.materialize(current);\n      }\n    }\n\n    return _load;\n  }();\n\n  _proto.newElement = function () {\n    function newElement(type, current) {\n      if (!this.inMemoryRendering) {\n        return;\n      }\n\n      current[type].parent = current[type].parent ? current[type].parent : document.createElement('div');\n\n      if (!current[type].element) {\n        current[type].element = this.getMemoryElement();\n        current[type].parent.appendChild(current[type].element);\n        current[type].element._parentElement = current[type].parent;\n      }\n    }\n\n    return newElement;\n  }();\n\n  _proto.newState = function () {\n    function newState() {\n      var layout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      var template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var base = {\n        materialized: false,\n        data: null,\n        callback: function () {},\n        layout: {\n          view: null,\n          name: '',\n          blaze: null,\n          parent: null,\n          element: null\n        },\n        template: {\n          view: null,\n          name: '',\n          blaze: null,\n          parent: null,\n          element: null\n        }\n      };\n\n      if (!this.inMemoryRendering || !layout && !template) {\n        return base;\n      }\n\n      if (layout && this.cache[layout]) {\n        base.layout = this.cache[layout];\n      }\n\n      if (template && this.cache[template]) {\n        base.template = this.cache[template];\n      }\n\n      this.cache[template] = base;\n      return base;\n    }\n\n    return newState;\n  }();\n\n  _proto.materialize = function () {\n    function materialize(current) {\n      if (!Blaze || !Template) {\n        return;\n      }\n\n      if (current.template.name && !current.materialized) {\n        var getData = function () {\n          return current.data;\n        };\n\n        if (!this.yield) {\n          current.materialized = false;\n          return;\n        }\n\n        current.materialized = true;\n\n        if (this.inMemoryRendering) {\n          current.template.view = Blaze.renderWithData(current.template.blaze, getData, current.template.element, this.yield.view);\n\n          if (this.yield) {\n            this.yield.view._domrange.parentElement.appendChild(current.template.element);\n\n            this.isRendering = false;\n            current.materialized = true;\n            current.callback();\n\n            current.callback = function () {};\n          } else {\n            current.materialized = false;\n          }\n        } else {\n          if (this.yield) {\n            current.template.view = Blaze.renderWithData(current.template.blaze, getData, this.yield.view._domrange.parentElement, this.yield.view);\n            this.isRendering = false;\n            current.materialized = true;\n            current.callback();\n\n            current.callback = function () {};\n          } else {\n            current.materialized = false;\n          }\n        }\n      }\n    }\n\n    return materialize;\n  }();\n\n  return BlazeRenderer;\n}();\n\nmodule.exportDefault(BlazeRenderer);","map":{"version":3,"sources":["packages/ostrio:flow-router-extra/client/renderer.js"],"names":["Meteor","module","link","v","_helpers","requestAnimFrame","Blaze","Template","Package","templating","blaze","_BlazeRemove","view","remove","_e","_destroyView","_domrange","destroy","__e","BlazeRenderer","opts","rootElement","document","body","self","isRendering","queue","yield","cache","old","newState","materialized","router","inMemoryRendering","getMemoryElement","createElement","isFunction","Error","onCreated","onRendered","materialize","onDestroyed","template","render","__layout","__template","__data","__callback","isString","push","startQueue","length","task","shift","proceed","apply","bind","data","layout","_layout","_template","callback","viewName","replace","isObject","error","onRenderError","call","current","updateTemplate","forceReRender","_current","route","conf","name","newElement","_render","_load","getData","renderWithData","element","appendChild","updateLayout","dataVar","set","type","parent","_parentElement","base","parentElement","exportDefault"],"mappings":"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","sourcesContent":["import { Meteor }           from 'meteor/meteor';\nimport { _helpers }         from './../lib/_helpers.js';\nimport { requestAnimFrame } from './modules.js';\n\nlet Blaze;\nlet Template;\n\nif (Package.templating && Package.blaze) {\n  Blaze    = Package.blaze.Blaze;\n  Template = Package.templating.Template;\n}\n\nconst _BlazeRemove = function (view) {\n  try {\n    Blaze.remove(view);\n  } catch (_e) {\n    try {\n      Blaze._destroyView(view);\n      view._domrange.destroy();\n    } catch (__e) {\n      view._domrange.destroy();\n    }\n  }\n};\n\nclass BlazeRenderer {\n  constructor(opts = {}) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    this.rootElement  = opts.rootElement || function () {\n      return document.body;\n    };\n\n    const self        = this;\n    this.isRendering  = false;\n    this.queue        = [];\n    this.yield        = null;\n    this.cache        = {};\n    this.old          = this.newState();\n    this.old.materialized = true;\n\n    this.router            = opts.router || false;\n    this.inMemoryRendering = opts.inMemoryRendering || false;\n    this.getMemoryElement  = opts.getMemoryElement || function () {\n      return document.createElement('div');\n    };\n\n    if (!this.getMemoryElement || !_helpers.isFunction(this.getMemoryElement)) {\n      throw new Meteor.Error(400, '{getMemoryElement} must be a function, which returns new DOM element');\n    }\n\n    if (!this.rootElement || !_helpers.isFunction(this.rootElement)) {\n      throw new Meteor.Error(400, 'You must pass function into BlazeRenderer constructor, which returns DOM element');\n    }\n\n    Template.yield = new Template('yield', function () {});\n\n    Template.yield.onCreated(function () {\n      self.yield = this;\n    });\n\n    Template.yield.onRendered(function () {\n      self.yield = this;\n      self.materialize(self.old);\n    });\n\n    Template.yield.onDestroyed(function () {\n      if (self.old.template.view) {\n        _BlazeRemove(self.old.template.view);\n        self.old.template.view = null;\n        self.old.materialized = false;\n      }\n      self.yield = null;\n    });\n  }\n\n  render(__layout, __template = false, __data = {}, __callback) {\n    if (!Blaze || !Template) {\n      throw new Meteor.Error(400, '`.render()` - Requires `blaze` and `templating`, or `blaze-html-templates` packages to be installed');\n    }\n\n    if (!__layout) {\n      throw new Meteor.Error(400, '`.render()` - Requires at least one argument');\n    } else if (!_helpers.isString(__layout) && !(__layout instanceof Blaze.Template)) {\n      throw new Meteor.Error(400, '`.render()` - First argument must be a String or instance of Blaze.Template');\n    }\n\n    this.queue.push([__layout, __template, __data, __callback]);\n    this.startQueue();\n  }\n\n  startQueue() {\n    if (this.queue.length) {\n      if (!this.isRendering) {\n        this.isRendering = true;\n        const task = this.queue.shift();\n        this.proceed.apply(this, task);\n        if (this.queue.length) {\n          requestAnimFrame(this.startQueue.bind(this));\n        }\n      } else {\n        requestAnimFrame(this.startQueue.bind(this));\n      }\n    }\n  }\n\n  proceed(__layout, __template = false, __data = {}, __callback) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    let data      = __data;\n    let layout    = __layout;\n    let _layout   = false;\n    let template  = __template;\n    let _template = false;\n    let callback  = __callback || (() => {});\n\n    if (_helpers.isString(layout)) {\n      _layout = typeof Template !== 'undefined' && Template !== null ? Template[layout] : void 0;\n    } else if (layout instanceof Blaze.Template) {\n      _layout = layout;\n      layout  = layout.viewName.replace('Template.', '');\n    } else {\n      layout = false;\n    }\n\n    if (_helpers.isString(template)) {\n      _template = typeof Template !== 'undefined' && Template !== null ? Template[template] : void 0;\n    } else if (template instanceof Blaze.Template) {\n      _template = template;\n      template  = template.viewName.replace('Template.', '');\n    } else if (_helpers.isObject(template)) {\n      data     = template;\n      template = false;\n    } else if (_helpers.isFunction(template)) {\n      callback = template;\n      template = false;\n    } else {\n      template = false;\n    }\n\n    if (_helpers.isFunction(data)) {\n      callback = data;\n      data = {};\n    } else if (!_helpers.isObject(data)) {\n      data = {};\n    }\n\n    if (!_helpers.isFunction(callback)) {\n      callback = () => {};\n    }\n\n    if (!_layout) {\n      this.old.materialized = true;\n      this.isRendering = false;\n      const error = new Meteor.Error(404, `No such layout template: ${layout}`);\n      this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, error);\n      callback(error);\n      throw error;\n    }\n\n    const current      = this.newState(layout, template);\n    current.data       = data;\n    current.callback   = callback;\n    let updateTemplate = true;\n\n    const forceReRender = this.router && this.router._current && this.router._current.route && this.router._current.route.conf && this.router._current.route.conf.forceReRender === true;\n    if (template) {\n      if (!_template) {\n        this.old.materialized = true;\n        this.isRendering = false;\n        const error = new Meteor.Error(404, `No such template: ${template}`);\n        this.router.onRenderError && _helpers.isFunction(this.router.onRenderError) && this.router.onRenderError.call(this, error);\n        current.callback(error);\n        throw error;\n      }\n\n      if (forceReRender || this.old.template.name !== template) {\n        current.template.name  = template;\n        current.template.blaze = _template;\n        this.newElement('template', current);\n\n        if (this.old.template.view) {\n          _BlazeRemove(this.old.template.view);\n          this.old.template.view = null;\n          this.old.materialized = false;\n        }\n        updateTemplate = false;\n      } else {\n        current.template = this.old.template;\n      }\n    }\n\n    if (!template || this.old.layout.name !== layout) {\n      current.layout.name    = layout;\n      current.layout.blaze   = _layout;\n      current.template.name  = template;\n      current.template.blaze = _template;\n      this.newElement('layout', current);\n\n      if (this.old.layout.view) {\n        _BlazeRemove(this.old.layout.view);\n        this.old.layout.view = null;\n      }\n\n      this._render(current);\n    } else if (template) {\n      current.layout         = this.old.layout;\n      current.template.name  = template;\n      current.template.blaze = _template;\n      this._load(updateTemplate, true, current);\n    } else {\n      current.layout = this.old.layout;\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    }\n\n    this.old = current;\n  }\n\n  _render(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    const getData = () => {\n      return current.data;\n    };\n\n    const rootElement = this.rootElement();\n    if (!rootElement) {\n      throw new Meteor.Error(400, 'BlazeRenderer can\\'t find root element!');\n    }\n\n    if (this.inMemoryRendering) {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, current.layout.element);\n      requestAnimFrame(() => {\n        rootElement.appendChild(current.layout.element);\n        this._load(false, false, current);\n      });\n    } else {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, rootElement);\n      this._load(false, false, current);\n    }\n  }\n\n  _load(updateTemplate, updateLayout, current) {\n    if (updateLayout && current.layout.view) {\n      current.layout.view.dataVar.set(current.data);\n    }\n\n    if (current.template.view && updateTemplate) {\n      current.template.view.dataVar.set(current.data);\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    } else if (!current.template.name) {\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    } else if (current.template.name && !this.yield) {\n      this.isRendering = false;\n      current.materialized = false;\n      current.callback();\n      current.callback = () => {};\n    } else if (current.template.name && this.yield) {\n      this.materialize(current);\n    }\n  }\n\n  newElement(type, current) {\n    if (!this.inMemoryRendering) {\n      return;\n    }\n\n    current[type].parent = current[type].parent ? current[type].parent : document.createElement('div');\n    if (!current[type].element) {\n      current[type].element = this.getMemoryElement();\n      current[type].parent.appendChild(current[type].element);\n      current[type].element._parentElement = current[type].parent;\n    }\n  }\n\n  newState(layout = false, template = false) {\n    const base = {\n      materialized: false,\n      data: null,\n      callback: function () {},\n      layout: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      },\n      template: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      }\n    };\n\n    if (!this.inMemoryRendering || (!layout && !template)) {\n      return base;\n    }\n\n    if (layout && this.cache[layout]) {\n      base.layout = this.cache[layout];\n    }\n\n    if (template && this.cache[template]) {\n      base.template = this.cache[template];\n    }\n\n    this.cache[template] = base;\n    return base;\n  }\n\n  materialize(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    if (current.template.name && !current.materialized) {\n      const getData = () => {\n        return current.data;\n      };\n\n      if (!this.yield) {\n        current.materialized = false;\n        return;\n      }\n\n      current.materialized = true;\n      if (this.inMemoryRendering) {\n        current.template.view = Blaze.renderWithData(current.template.blaze, getData, current.template.element, this.yield.view);\n        if (this.yield) {\n          this.yield.view._domrange.parentElement.appendChild(current.template.element);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      } else {\n        if (this.yield) {\n          current.template.view = Blaze.renderWithData(current.template.blaze, getData, this.yield.view._domrange.parentElement, this.yield.view);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      }\n    }\n  }\n}\n\nexport default BlazeRenderer;\n"]},"sourceType":"module","hash":"1eb28de0f90009620b8a766168a6bc920bafdc17"}
